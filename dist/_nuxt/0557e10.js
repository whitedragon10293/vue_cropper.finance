(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{1277:function(t,e,n){var content=n(1419);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(26).default)("7649abd5",content,!0,{sourceMap:!1})},1418:function(t,e,n){"use strict";n(1277)},1419:function(t,e,n){var o=n(25)(!1);o.push([t.i,".warning-style{font-weight:700;color:#f0b90b}.swap-btn.warning-style{font-weight:400}.error-style{font-weight:700;color:#ed4b9e}.swap-btn.error-style{font-weight:400}.container{max-width:450px}.container .price-info{display:grid;grid-auto-rows:auto;grid-row-gap:8px;row-gap:8px;padding:0 12px;font-size:12px;line-height:20px;margin-bottom:6px}.container .price-info .anticon-swap{margin-left:10px;padding:5px;border-radius:50%;background:#000829}.container .price-info .price-base{line-height:24px}.container .price-info .fs-container .name{opacity:.75}.container .not-enough-sol-alert{display:flex;justify-content:center;align-items:center;grid-gap:8px;gap:8px;margin-bottom:-18px;margin-top:4px}.container .change-side div{height:32px;width:32px;border-radius:50%;background:#000829;cursor:pointer}.container .fetching-unsettled{margin:12px;display:flex;flex-direction:column;justify-content:center;color:hsla(0,0%,100%,.67843)}.container .fetching-unsettled span{margin-top:16px;text-align:center}.container .settle.card-body{padding:16px 24px}.container .extra{margin-top:32px;margin-bottom:32px}.container .extra .settel-panel .align-right{text-align:right}.container .extra .settel-panel th{font-weight:400}.container .extra .settel-panel td{padding-bottom:4px;width:25%}.container .extra .settel-panel thead{font-size:14px}.container .extra .settel-panel thead tr:first-child{margin-top:8px}.container .extra .settel-panel tbody tr:first-child td{padding-top:6px}",""]),t.exports=o},1466:function(t,e,n){"use strict";n.r(e);n(49),n(53),n(76);var o=n(9),r=n(34),c=(n(638),n(407)),l=n.n(c),progress=(n(1220),n(1221)),d=n.n(progress),m=(n(140),n(87)),h=n.n(m),f=(n(634),n(633)),C=n.n(f),A=(n(205),n(48)),v=n.n(A),k=(n(40),n(155),n(130),n(176),n(156),n(95),n(90),n(123),n(56),n(63),n(31),n(41),n(89),n(642),n(110),n(635),n(10)),w=n(83),S=n(1215),y=n(74),_=n(169),I=n(0),O=n(191),x=n(19),M=n(3),U=n(4),j=n(1236),P=n(16),T=n(112),$=n(108),F=n(72);function B(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function L(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?B(Object(source),!0).forEach((function(e){Object(r.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):B(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var W=Object(I.f)("RAY"),E=k.default.extend({components:{Icon:v.a,Tooltip:C.a,Button:h.a,Progress:d.a,Spin:l.a},data:function(){return{TOKENS:I.c,solBalance:null,autoRefreshTime:60,countdown:0,marketTimer:null,initialized:!1,loading:!1,swaping:!1,asks:{},bids:{},isFetchingUnsettled:!1,unsettledOpenOrders:null,baseSymbol:"",baseUnsettledAmount:0,isSettlingBase:!1,quoteSymbol:"",quoteUnsettledAmount:0,isSettlingQuote:!1,coinSelectShow:!1,selectFromCoin:!0,fixedFromCoin:!0,fromCoin:W,toCoin:null,fromCoinAmount:"",toCoinAmount:"",toCoinWithSlippage:"",isWrap:!1,market:null,marketAddress:"",lpMintAddress:"",endpoint:"",priceImpact:0,coinBasePrice:!0,outToPirceValue:0,hasPriceSwapped:!1,officialPool:!0,userCheckUnofficial:!1,userCheckUnofficialMint:void 0,userCheckUnofficialShow:!1,findUrlAmmId:!1,ammId:void 0,ammIdSelectShow:!1,ammIdSelectList:[],ammIdSelectOld:!1,ammIdOrMarketSearchShow:!1,userNeedAmmIdOrMarket:void 0,setCoinFromMintLoading:!1,asksAndBidsLoading:!0}},head:{title:"CropperFinance Swap"},computed:L({},Object(w.e)(["wallet","swap","liquidity","url","setting"])),watch:{fromCoinAmount:function(t,e){var n=this;this.$nextTick((function(){O.b.test(Object(O.a)(t))?n.updateAmounts():n.fromCoinAmount=e}))},"wallet.tokenAccounts":{handler:function(t){this.updateCoinInfo(t),this.findMarket(),this.ammId&&this.needUserCheckUnofficialShow(this.ammId),this.market&&this.fetchUnsettledByMarket(),this.solBalance=this.wallet.tokenAccounts[I.b.mintAddress]},deep:!0},fromCoin:function(t,e){this.setCoinFromMintLoading||null!==e&&null!==t&&t.mintAddress===e.mintAddress||(this.userNeedAmmIdOrMarket=void 0,this.findMarket(),this.fromCoinAmount="",this.toCoinAmount="",this.ammIdSelectOld=!1)},baseUnsettledAmount:function(){this.isSettlingBase=!1},quoteUnsettledAmount:function(){this.isSettlingQuote=!1},toCoin:function(t,e){this.setCoinFromMintLoading||null!==e&&null!==t&&t.mintAddress===e.mintAddress||(this.userNeedAmmIdOrMarket=void 0,this.findMarket(),this.fromCoinAmount="",this.toCoinAmount="",this.ammIdSelectOld=!1)},market:function(){this.baseSymbol="",this.baseUnsettledAmount=0,this.quoteSymbol="",this.quoteUnsettledAmount=0,this.unsettledOpenOrders=null,this.fetchUnsettledByMarket()},marketAddress:function(){this.updateAmounts()},asks:function(){this.updateAmounts()},bids:function(){this.updateAmounts()},"liquidity.infos":{handler:function(t){this.updateAmounts();var e=this.$route.query,n=e.from,o=e.to,r=e.ammId;this.findUrlAmmId&&this.setCoinFromMint(r,n,o),this.findMarket()},deep:!0},"swap.markets":{handler:function(t){this.findMarket()},deep:!0},"setting.slippage":{handler:function(){this.updateAmounts()},deep:!0}},mounted:function(){this.updateCoinInfo(this.wallet.tokenAccounts),this.setMarketTimer();var t=this.$route.query,e=t.from,n=t.to,o=t.ammId;this.setCoinFromMint(o,e,n)},methods:{gt:P.b,get:S.a,openFromCoinSelect:function(){var t=this;this.selectFromCoin=!0,this.closeAllModal("coinSelectShow"),setTimeout((function(){t.coinSelectShow=!0}),1)},openToCoinSelect:function(){var t=this;this.selectFromCoin=!1,this.closeAllModal("coinSelectShow"),setTimeout((function(){t.coinSelectShow=!0}),1)},onCoinSelect:function(t){var e,n,o=this;if(null!==t)this.selectFromCoin?(this.fromCoin=Object(y.a)(t),(null===(e=this.toCoin)||void 0===e?void 0:e.mintAddress)===t.mintAddress&&(this.toCoin=null,this.changeCoinAmountPosition())):(this.toCoin=Object(y.a)(t),(null===(n=this.fromCoin)||void 0===n?void 0:n.mintAddress)===t.mintAddress&&(this.fromCoin=null,this.changeCoinAmountPosition()));else{if(null!==this.fromCoin){var r=Object.values(I.c).find((function(t){var e;return t.mintAddress===(null===(e=o.fromCoin)||void 0===e?void 0:e.mintAddress)}));null==r&&(this.fromCoin=null)}if(null!==this.toCoin){var c=Object.values(I.c).find((function(t){var e;return t.mintAddress===(null===(e=o.toCoin)||void 0===e?void 0:e.mintAddress)}));null==c&&(this.toCoin=null)}}this.coinSelectShow=!1},setCoinFromMint:function(t,e,n){var o,r,c=this;this.setCoinFromMintLoading=!0;try{this.findUrlAmmId=!this.liquidity.initialized,this.userNeedAmmIdOrMarket=t;var l=Object($.f)(t,e,n);l&&(e&&(o=l.coin.mintAddress===e?l.coin:l.pc,r=l.coin.mintAddress===o.mintAddress?l.pc:l.coin),n&&(r=l.coin.mintAddress===n?l.coin:l.pc,o=l.coin.mintAddress===r.mintAddress?l.pc:l.coin),e&&n||(o=l.coin,r=l.pc)),(o||r)&&(o&&(o.balance=Object(S.a)(this.wallet.tokenAccounts,"".concat(o.mintAddress,".balance")),this.fromCoin=o),r&&(r.balance=Object(S.a)(this.wallet.tokenAccounts,"".concat(r.mintAddress,".balance")),this.toCoin=r))}catch(t){this.$notify.warning({message:t.message,description:""})}setTimeout((function(){c.setCoinFromMintLoading=!1,c.findMarket()}),1)},needUserCheckUnofficialShow:function(t){var e=this;if(this.wallet.connected&&!this.officialPool){var n=localStorage.getItem("".concat(this.wallet.address,"--checkAmmId"));if((n?n.split("---"):[]).includes(t))return this.userCheckUnofficial=!0,this.userCheckUnofficialMint=t,void(this.userCheckUnofficialShow=!1);if(this.userCheckUnofficialMint===t)return this.userCheckUnofficial=!0,void(this.userCheckUnofficialShow=!1);this.userCheckUnofficial=!1,this.closeAllModal("userCheckUnofficialShow"),setTimeout((function(){e.userCheckUnofficialShow=!0}),1)}},onAmmIdSelect:function(t){this.ammIdSelectShow=!1,t?(this.lpMintAddress=t.lp.mintAddress,this.ammId=t.ammId,this.userNeedAmmIdOrMarket=this.ammId,this.officialPool=t.official,this.findMarket()):(this.ammIdSelectOld=!0,this.findMarket())},onAmmIdOrMarketInput:function(t){this.ammIdOrMarketSearchShow=!1,this.setCoinFromMint(t,void 0,void 0),this.findMarket()},onUserCheckUnofficialSelect:function(t,e){if(this.userCheckUnofficialShow=!1,t){if(this.userCheckUnofficial=!0,this.userCheckUnofficialMint=this.ammId,e){var n=localStorage.getItem("".concat(this.wallet.address,"--checkAmmId"));n?localStorage.setItem("".concat(this.wallet.address,"--checkAmmId"),n+"---".concat(this.ammId)):localStorage.setItem("".concat(this.wallet.address,"--checkAmmId"),"".concat(this.ammId))}}else this.fromCoin=null,this.toCoin=null,this.ammId=void 0,this.officialPool=!0},changeCoinPosition:function(){var t=this;this.setCoinFromMintLoading=!0;var e=this.fromCoin,n=this.toCoin;setTimeout((function(){t.setCoinFromMintLoading=!1}),1),this.fromCoin=n,this.toCoin=e,this.changeCoinAmountPosition()},changeCoinAmountPosition:function(){var t=this.fromCoinAmount,e=this.toCoinAmount;this.fromCoinAmount=e,this.toCoinAmount=t},updateCoinInfo:function(t){if(this.fromCoin){var e=t[this.fromCoin.mintAddress];e&&(this.fromCoin=L(L({},this.fromCoin),e))}if(this.toCoin){var n=t[this.toCoin.mintAddress];n&&(this.toCoin=L(L({},this.toCoin),n))}},findMarket:function(){var t=this;if(this.fromCoin&&this.toCoin&&this.liquidity.initialized){var e=this.userNeedAmmIdOrMarket;if(Object($.e)(this.fromCoin.mintAddress,this.toCoin.mintAddress))return this.isWrap=!0,this.initialized=!0,this.officialPool=!0,void(this.ammId=void 0);for(var n="",o=0,r=Object.keys(this.swap.markets);o<r.length;o++){var address=r[o];if(Object(F.g)(address)){var c=Object(y.a)(this.swap.markets[address]),l=this.fromCoin.mintAddress,d=this.toCoin.mintAddress;l===I.b.mintAddress&&(l=I.c.WSOL.mintAddress),d===I.b.mintAddress&&(d=I.c.WSOL.mintAddress),(c.baseMint.toBase58()===l&&c.quoteMint.toBase58()===d||c.baseMint.toBase58()===d&&c.quoteMint.toBase58()===l)&&(n=address)}}if(this.fromCoin.mintAddress&&this.toCoin.mintAddress){var m,h,f=Object(F.f)(this.fromCoin.mintAddress===I.c.WSOL.mintAddress?I.b.mintAddress:this.fromCoin.mintAddress,this.toCoin.mintAddress===I.c.WSOL.mintAddress?I.b.mintAddress:this.toCoin.mintAddress,"string"==typeof e?e:void 0),C=Object(F.d)(this.fromCoin.mintAddress===I.c.WSOL.mintAddress?I.b.mintAddress:this.fromCoin.mintAddress,this.toCoin.mintAddress===I.c.WSOL.mintAddress?I.b.mintAddress:this.toCoin.mintAddress,"string"==typeof e?e:void 0,[3]),A=!0;if(1===f.length&&!f[0].official&&C.length>0)console.log("v3");else if(1===f.length&&f[0].official)m=f[0].lp.mintAddress,h=f[0].ammId,A=f[0].official,this.userCheckUnofficialMint=void 0,n=f[0].serumMarket;else if(""===n||void 0!==e&&e!==n){if(1===f.length&&e)h=f[0].ammId,m=f[0].lp.mintAddress,A=f[0].official,n=f[0].serumMarket;else if(f.length>0&&this.ammIdSelectOld)console.log("last user select none");else if(f.length>0)return this.coinSelectShow=!1,void setTimeout((function(){t.ammIdSelectShow=!0,t.ammIdSelectList=Object.values(t.liquidity.infos).filter((function(t){return f.find((function(e){return e.ammId===t.ammId}))}))}),1)}else console.log("official market");this.lpMintAddress=null!=m?m:"",this.initialized=!0,this.ammId=h,this.officialPool=A,h!==this.userCheckUnofficialMint&&(this.userCheckUnofficialMint=void 0),h&&this.needUserCheckUnofficialShow(h)}n?this.marketAddress!==n&&(this.marketAddress=n,this.lpMintAddress="",this.isWrap=!1,_.Market.load(this.$web3,new M.PublicKey(n),{},new M.PublicKey(U.q)).then((function(e){t.market=e,t.getOrderBooks()}))):(this.endpoint="",this.marketAddress="",this.market=null,this.lpMintAddress="",this.isWrap=!1),this.updateUrl()}else this.ammId=void 0,this.endpoint="",this.marketAddress="",this.market=null,this.lpMintAddress="",this.isWrap=!1},getOrderBooks:function(){var t=this;this.loading=!0,this.asksAndBidsLoading=!0,this.countdown=this.autoRefreshTime;var e=this.$web3;if(this.marketAddress&&Object(S.a)(this.swap.markets,this.marketAddress)){var n=Object(S.a)(this.swap.markets,this.marketAddress),o=n.bids,r=n.asks;Object(x.m)(e,[o,r],x.a).then((function(e){e.forEach((function(e){var data=e.account.data,o=_.Orderbook.decode(n,data),r=o.isBids,c=o.slab;r?t.bids=c:t.asks=c,t.asksAndBidsLoading=!1}))})).finally((function(){t.initialized=!0,t.loading=!1,t.countdown=0}))}else this.loading=!1},updateAmounts:function(){var t=this,e="",n=null,o=0,r=0,c="";if(this.fromCoin&&this.toCoin&&this.isWrap&&this.fromCoinAmount)this.toCoinAmount=this.fromCoinAmount;else{if(this.fromCoin&&this.toCoin&&this.ammId&&this.fromCoinAmount){var l=Object.values(this.$accessor.liquidity.infos).find((function(p){return p.ammId===t.ammId})),d=Object(j.c)(l,this.fromCoin.mintAddress,this.toCoin.mintAddress,this.fromCoinAmount,this.setting.slippage),m=d.amountOut,h=d.amountOutWithSlippage,f=d.priceImpact;m.isNullOrZero()||(console.log("input: ".concat(this.fromCoinAmount," raydium out: ").concat(h.fixed())),e=m.fixed(),n=h,o=+new P.a(parseFloat(e)/parseFloat(this.fromCoinAmount),this.toCoin.decimals,!1).fixed(),r=f,c="CropperFinance Pool")}if(this.fromCoin&&this.toCoin&&this.marketAddress&&this.market&&this.asks&&this.bids&&this.fromCoinAmount&&!this.asksAndBidsLoading){var C=Object(j.b)(this.market,this.asks,this.bids,this.fromCoin.mintAddress,this.toCoin.mintAddress,this.fromCoinAmount,this.setting.slippage),A=C.amountOut,v=C.amountOutWithSlippage,k=C.priceImpact,w=new P.a(A,this.toCoin.decimals,!1),S=new P.a(v,this.toCoin.decimals,!1);w.isNullOrZero()||(console.log("input: ".concat(this.fromCoinAmount,"   serum out: ").concat(S.fixed())),n&&!n.wei.isLessThan(S.wei)||(e=w.fixed(),n=S,o=+new P.a(parseFloat(e)/parseFloat(this.fromCoinAmount),this.toCoin.decimals,!1).fixed(),r=k,c="serum DEX"))}n?(this.toCoinAmount=e,this.toCoinWithSlippage=n.fixed(),this.outToPirceValue=o,this.priceImpact=r,this.endpoint=c):(this.toCoinAmount="",this.toCoinWithSlippage="",this.outToPirceValue=0,this.priceImpact=0,this.endpoint="")}},setMarketTimer:function(){var t=this;this.marketTimer=setInterval((function(){t.loading||t.countdown<t.autoRefreshTime&&(t.countdown+=1,t.countdown===t.autoRefreshTime&&t.getOrderBooks())}),1e3)},placeOrder:function(){var t=this;this.swaping=!0;var e=Object(T.a)().toString();if(this.$notify.info({key:e,message:"Making transaction...",description:"",duration:0}),this.isWrap)Object(j.h)(this.$axios,this.$web3,this.$wallet,this.fromCoin.mintAddress,this.toCoin.mintAddress,Object(S.a)(this.wallet.tokenAccounts,"".concat(this.fromCoin.mintAddress,".tokenAccountAddress")),Object(S.a)(this.wallet.tokenAccounts,"".concat(this.toCoin.mintAddress,".tokenAccountAddress")),this.fromCoinAmount).then((function(n){var o,r;t.$notify.info({key:e,message:"Transaction has been sent",description:function(e){return e("div",["Confirmation is in progress.  Check your transaction on ",e("a",{attrs:{href:"".concat(t.url.explorer,"/tx/").concat(n),target:"_blank"}},"here")])}});var c="Unwrap ".concat(t.fromCoinAmount," ").concat(null===(o=t.fromCoin)||void 0===o?void 0:o.symbol," to ").concat(t.toCoinAmount," ").concat(null===(r=t.toCoin)||void 0===r?void 0:r.symbol);t.$accessor.transaction.sub({txid:n,description:c})})).catch((function(n){t.$notify.error({key:e,message:"Swap failed",description:n.message})})).finally((function(){t.swaping=!1}));else if("CropperFinance Pool"===this.endpoint&&this.ammId){var n=Object.values(this.$accessor.liquidity.infos).find((function(p){return p.ammId===t.ammId}));Object(j.f)(this.$web3,this.$wallet,n,this.fromCoin.mintAddress,this.toCoin.mintAddress,Object(S.a)(this.wallet.tokenAccounts,"".concat(this.fromCoin.mintAddress,".tokenAccountAddress")),Object(S.a)(this.wallet.tokenAccounts,"".concat(this.toCoin.mintAddress,".tokenAccountAddress")),this.fromCoinAmount,this.toCoinWithSlippage).then((function(n){var o,r;t.$notify.info({key:e,message:"Transaction has been sent",description:function(e){return e("div",["Confirmation is in progress.  Check your transaction on ",e("a",{attrs:{href:"".concat(t.url.explorer,"/tx/").concat(n),target:"_blank"}},"here")])}});var c="Swap ".concat(t.fromCoinAmount," ").concat(null===(o=t.fromCoin)||void 0===o?void 0:o.symbol," to ").concat(t.toCoinAmount," ").concat(null===(r=t.toCoin)||void 0===r?void 0:r.symbol);t.$accessor.transaction.sub({txid:n,description:c})})).catch((function(n){t.$notify.error({key:e,message:"Swap failed",description:n.message})})).finally((function(){t.swaping=!1}))}else Object(j.d)(this.$web3,this.$wallet,this.market,this.asks,this.bids,this.fromCoin.mintAddress,this.toCoin.mintAddress,Object(S.a)(this.wallet.tokenAccounts,"".concat(this.fromCoin.mintAddress,".tokenAccountAddress")),Object(S.a)(this.wallet.tokenAccounts,"".concat(this.toCoin.mintAddress,".tokenAccountAddress")),this.fromCoinAmount,this.setting.slippage).then((function(n){var o,r;t.$notify.info({key:e,message:"Transaction has been sent",description:function(e){return e("div",["Confirmation is in progress.  Check your transaction on ",e("a",{attrs:{href:"".concat(t.url.explorer,"/tx/").concat(n),target:"_blank"}},"here")])}});var c="Swap ".concat(t.fromCoinAmount," ").concat(null===(o=t.fromCoin)||void 0===o?void 0:o.symbol," to ").concat(t.toCoinAmount," ").concat(null===(r=t.toCoin)||void 0===r?void 0:r.symbol);t.$accessor.transaction.sub({txid:n,description:c})})).catch((function(n){t.$notify.error({key:e,message:"Swap failed",description:n.message})})).finally((function(){t.swaping=!1}))},updateUrl:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("/swap/"===t.$route.path){e.next=2;break}return e.abrupt("return");case 2:if(n=t.$route.query,o=n.from,r=n.to,!t.ammId){e.next=8;break}return e.next=6,t.$router.push({path:"/swap/",query:{ammId:t.ammId}});case 6:e.next=17;break;case 8:if(!t.fromCoin||!t.toCoin){e.next=14;break}if(t.fromCoin.mintAddress===o&&t.toCoin.mintAddress===r){e.next=12;break}return e.next=12,t.$router.push({path:"/swap/",query:{from:t.fromCoin.mintAddress,to:t.toCoin.mintAddress}});case 12:e.next=17;break;case 14:if(t.$route.query&&0===Object.keys(t.$route.query).length){e.next=17;break}return e.next=17,t.$router.push({path:"/swap/"});case 17:case"end":return e.stop()}}),e)})))()},closeAllModal:function(t){"coinSelectShow"!==t&&(this.coinSelectShow=!1),"ammIdSelectShow"!==t&&(this.ammIdSelectShow=!1),"userCheckUnofficialShow"!==t&&(this.userCheckUnofficialShow=!1),"ammIdOrMarketSearchShow"!==t&&(this.ammIdOrMarketSearchShow=!1)},fetchUnsettledByMarket:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isFetchingUnsettled){e.next=2;break}return e.abrupt("return");case 2:if(t.$web3&&t.$wallet&&t.market){e.next=4;break}return e.abrupt("return");case 4:return t.isFetchingUnsettled=!0,e.prev=5,e.next=8,Object(j.a)(t.$web3,t.$wallet,t.market);case 8:if(r=e.sent){e.next=11;break}throw new Error("not enough data");case 11:t.baseSymbol=null!==(n=r.baseSymbol)&&void 0!==n?n:"",t.baseUnsettledAmount=r.baseUnsettledAmount,t.quoteSymbol=null!==(o=r.quoteSymbol)&&void 0!==o?o:"",t.quoteUnsettledAmount=r.quoteUnsettledAmount,t.unsettledOpenOrders=r.openOrders,e.next=20;break;case 18:e.prev=18,e.t0=e.catch(5);case 20:return e.prev=20,t.isFetchingUnsettled=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[5,18,20,23]])})))()},settleFunds:function(t){var e=this,n=Object(T.a)().toString();this.$notify.info({key:n,message:"Making transaction...",description:"",duration:0});var o=this.market.baseMintAddress.toBase58(),r=this.market.quoteMintAddress.toBase58(),c=Object(S.a)(this.wallet.tokenAccounts,"".concat(o,".tokenAccountAddress")),l=Object(S.a)(this.wallet.tokenAccounts,"".concat(r,".tokenAccountAddress"));if("quote"===t){var d=[l,c];c=d[0],l=d[1];var m=[r,o];o=m[0],r=m[1]}"quote"===t?this.isSettlingQuote=!0:this.isSettlingBase=!0,Object(j.e)(this.$web3,this.market,this.unsettledOpenOrders,this.$wallet,o,r,c,l).then((function(t){e.$notify.info({key:n,message:"Transaction has been sent",description:function(n){return n("div",["Confirmation is in progress.  Check your transaction on ",n("a",{attrs:{href:"".concat(e.url.explorer,"/tx/").concat(t),target:"_blank"}},"here")])}});e.$accessor.transaction.sub({txid:t,description:"Settle"})})).then((function(){e.fetchUnsettledByMarket()})).catch((function(t){e.$notify.error({key:n,message:"Settle failed",description:t.message}),e.isSettlingQuote=!1,e.isSettlingBase=!1}))}}}),z=(n(1418),n(24)),component=Object(z.a)(E,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("div",{staticClass:"page-head fs-container"},[n("span",{staticClass:"title"},[t._v("Swap")]),t._v(" "),n("div",{staticClass:"buttons"},[n("Tooltip",{attrs:{placement:"bottomRight"}},[n("template",{slot:"title"},[n("span",[t._v("\n            Displayed data will auto-refresh after\n            "+t._s(t.autoRefreshTime-t.countdown)+" seconds. Click this circle to update manually.\n          ")])]),t._v(" "),n("Progress",{class:t.marketAddress&&t.loading?"disabled":"",attrs:{type:"circle",width:20,"stroke-width":10,percent:100/t.autoRefreshTime*t.countdown,"show-info":!1},on:{click:function(){t.getOrderBooks(),t.$accessor.wallet.getTokenAccounts()}}})],2),t._v(" "),n("Tooltip",{attrs:{placement:"bottomRight"}},[n("template",{slot:"title"},[n("p",[t._v("Addresses")]),t._v(" "),n("div",{staticClass:"swap-info"},[t.fromCoin?n("div",{staticClass:"info"},[n("div",{staticClass:"symbol"},[t._v(t._s(t.fromCoin.symbol))]),t._v(" "),n("div",{staticClass:"address"},[t._v("\n                "+t._s(t.fromCoin.mintAddress.substr(0,14))+"\n                ...\n                "+t._s(t.fromCoin.mintAddress.substr(t.fromCoin.mintAddress.length-14,14))+"\n              ")]),t._v(" "),n("div",{staticClass:"action"},[n("Icon",{attrs:{type:"copy"},on:{click:function(e){return t.$accessor.copy(t.fromCoin.mintAddress)}}}),t._v(" "),n("a",{attrs:{href:t.url.explorer+"/token/"+t.fromCoin.mintAddress,target:"_blank"}},[n("Icon",{attrs:{type:"link"}})],1)],1)]):t._e(),t._v(" "),t.toCoin?n("div",{staticClass:"info"},[n("div",{staticClass:"symbol"},[t._v(t._s(t.toCoin.symbol))]),t._v(" "),n("div",{staticClass:"address"},[t._v("\n                "+t._s(t.toCoin.mintAddress.substr(0,14))+"\n                ...\n                "+t._s(t.toCoin.mintAddress.substr(t.toCoin.mintAddress.length-14,14))+"\n              ")]),t._v(" "),n("div",{staticClass:"action"},[n("Icon",{attrs:{type:"copy"},on:{click:function(e){return t.$accessor.copy(t.toCoin.mintAddress)}}}),t._v(" "),n("a",{attrs:{href:t.url.explorer+"/token/"+t.toCoin.mintAddress,target:"_blank"}},[n("Icon",{attrs:{type:"link"}})],1)],1)]):t._e(),t._v(" "),t.marketAddress?n("div",{staticClass:"info"},[n("div",{staticClass:"symbol"},[t._v("Market")]),t._v(" "),n("div",{staticClass:"address"},[t._v("\n                "+t._s(t.marketAddress.substr(0,14))+"\n                ...\n                "+t._s(t.marketAddress.substr(t.marketAddress.length-14,14))+"\n              ")]),t._v(" "),n("div",{staticClass:"action"},[n("Icon",{attrs:{type:"copy"},on:{click:function(e){return t.$accessor.copy(t.marketAddress)}}}),t._v(" "),t.officialPool?n("a",{attrs:{href:t.url.trade+"/"+t.marketAddress,target:"_blank"}},[n("Icon",{attrs:{type:"link"}})],1):n("a",{attrs:{href:t.url.explorer+"/account/"+t.marketAddress,target:"_blank"}},[n("Icon",{attrs:{type:"link"}})],1)],1)]):t._e(),t._v(" "),t.ammId?n("div",{staticClass:"info"},[n("div",{staticClass:"symbol"},[t._v("AMM ID")]),t._v(" "),n("div",{staticClass:"address"},[t._v("\n                "+t._s(t.ammId?t.ammId.substr(0,14):"")+"\n                ...\n                "+t._s(t.ammId?t.ammId.substr(t.ammId.length-14,14):"")+"\n              ")]),t._v(" "),n("div",{staticClass:"action"},[n("Icon",{attrs:{type:"copy"},on:{click:function(e){return t.$accessor.copy(t.ammId)}}}),t._v(" "),n("a",{attrs:{href:t.url.explorer+"/account/"+t.ammId,target:"_blank"}},[n("Icon",{attrs:{type:"link"}})],1)],1)]):t._e()])]),t._v(" "),n("Icon",{attrs:{type:"info-circle"}})],2),t._v(" "),n("Icon",{attrs:{type:"setting"},on:{click:t.$accessor.setting.open}}),t._v(" "),n("Tooltip",{attrs:{placement:"bottomRight"}},[n("template",{slot:"title"},[t._v(" Search for a pool ")]),t._v(" "),n("Icon",{attrs:{type:"search"},on:{click:function(e){t.ammIdOrMarketSearchShow=!0}}})],2)],1)]),t._v(" "),t.coinSelectShow?n("CoinSelect",{on:{onClose:function(){return t.coinSelectShow=!1},onSelect:t.onCoinSelect}}):t._e(),t._v(" "),n("AmmIdSelect",{attrs:{show:t.ammIdSelectShow,"liquidity-list":t.ammIdSelectList,"user-close":!0},on:{onClose:function(){return t.ammIdSelectShow=!1,t.ammIdSelectOld=!0},onSelect:t.onAmmIdSelect}}),t._v(" "),t.userCheckUnofficialShow?n("UnofficialPoolConfirmUser",{on:{onClose:function(){return t.userCheckUnofficialShow=!1},onSelect:t.onUserCheckUnofficialSelect}}):t._e(),t._v(" "),t.ammIdOrMarketSearchShow?n("InputAmmIdOrMarket",{on:{onClose:function(){return t.ammIdOrMarketSearchShow=!1},onInput:t.onAmmIdOrMarketInput}}):t._e(),t._v(" "),n("div",{staticClass:"card"},[n("div",{staticClass:"card-body"},[n("CoinInput",{attrs:{label:"From","balance-offset":t.fromCoin&&"SOL"===t.fromCoin.symbol?-.05:0,"mint-address":t.fromCoin?t.fromCoin.mintAddress:"","coin-name":t.fromCoin?t.fromCoin.symbol:"",balance:t.fromCoin?t.fromCoin.balance:null,"show-half":!0},on:{onInput:function(e){return t.fromCoinAmount=e},onFocus:function(){t.fixedFromCoin=!0},onMax:function(){t.fixedFromCoin=!0,t.fromCoinAmount=t.fromCoin&&t.fromCoin.balance?t.fromCoin.balance.fixed():"0"},onSelect:t.openFromCoinSelect},model:{value:t.fromCoinAmount,callback:function(e){t.fromCoinAmount=e},expression:"fromCoinAmount"}}),t._v(" "),n("div",{staticClass:"change-side fc-container"},[n("div",{staticClass:"fc-container",on:{click:t.changeCoinPosition}},[n("Icon",{attrs:{type:"swap",rotate:90}})],1)]),t._v(" "),n("CoinInput",{attrs:{label:"To (Estimate)","mint-address":t.toCoin?t.toCoin.mintAddress:"","coin-name":t.toCoin?t.toCoin.symbol:"",balance:t.toCoin?t.toCoin.balance:null,"show-max":!1,disabled:!0},on:{onInput:function(e){return t.toCoinAmount=e},onFocus:function(){t.fixedFromCoin=!1},onMax:function(){t.fixedFromCoin=!1,t.toCoinAmount=t.toCoin.balance.fixed()},onSelect:t.openToCoinSelect},model:{value:t.toCoinAmount,callback:function(e){t.toCoinAmount=e},expression:"toCoinAmount"}}),t._v(" "),n("div",{staticClass:"price-info",staticStyle:{padding:"0 12px"}},[t.fromCoin&&t.toCoin&&t.isWrap&&t.fromCoinAmount?n("div",{staticClass:"price-base fc-container"},[n("span",[t._v("\n            1 "+t._s(t.fromCoin.symbol)+" = 1\n            "+t._s(t.toCoin.symbol)+"\n          ")])]):t.fromCoin&&t.toCoin&&t.lpMintAddress&&t.fromCoinAmount||t.fromCoin&&t.toCoin&&t.marketAddress&&t.market&&t.asks&&t.bids&&t.fromCoinAmount?n("div",{staticClass:"price-base fc-container"},[n("span",[t._v("\n            1 "+t._s(t.hasPriceSwapped?t.toCoin.symbol:t.fromCoin.symbol)+" ≈\n            "+t._s(t.hasPriceSwapped?(1/t.outToPirceValue).toFixed(6):t.outToPirceValue)+"\n            "+t._s(t.hasPriceSwapped?t.fromCoin.symbol:t.toCoin.symbol)+"\n            "),n("Icon",{attrs:{type:"swap"},on:{click:function(){return t.hasPriceSwapped=!t.hasPriceSwapped}}})],1)]):t._e(),t._v(" "),n("div",{staticClass:"fs-container"},[n("span",{staticClass:"name"},[t._v("\n            Slippage Tolerance\n            "),n("Tooltip",{attrs:{placement:"right"}},[n("template",{slot:"title"},[t._v("\n                The maximum difference between your estimated price and execution price.\n              ")]),t._v(" "),n("Icon",{attrs:{type:"question-circle"}})],2)],1),t._v(" "),n("span",[t._v(" "+t._s(t.$accessor.setting.slippage)+"% ")])]),t._v(" "),t.endpoint?n("div",{staticClass:"fs-container"},[n("span",{staticClass:"name"},[t._v("\n            Swapping Through\n            "),n("Tooltip",{attrs:{placement:"right"}},[n("template",{slot:"title"},[t._v(" This venue gave the best price for your trade ")]),t._v(" "),n("Icon",{attrs:{type:"question-circle"}})],2)],1),t._v(" "),n("span",{staticStyle:{"text-transform":"capitalize"}},[t._v(" "+t._s(t.endpoint)+" ")])]):t._e(),t._v(" "),t.fromCoin&&t.toCoin&&t.fromCoinAmount&&t.toCoinWithSlippage?n("div",{staticClass:"fs-container"},[n("span",{staticClass:"name"},[t._v("\n            Minimum Received\n            "),n("Tooltip",{attrs:{placement:"right"}},[n("template",{slot:"title"},[t._v(" The least amount of tokens you will recieve on this trade ")]),t._v(" "),n("Icon",{attrs:{type:"question-circle"}})],2)],1),t._v(" "),n("span",[t._v(" "+t._s(t.toCoinWithSlippage)+" "+t._s(t.toCoin.symbol)+" ")])]):t._e(),t._v(" "),t.endpoint?n("div",{class:"fs-container price-impact "+(t.priceImpact>10?"error-style":t.priceImpact>5?"warning-style":"")},[n("span",{staticClass:"name"},[t._v("\n            Price Impact "+t._s(t.priceImpact>5?"Warning":"")+"\n            "),n("Tooltip",{attrs:{placement:"right"}},[n("template",{slot:"title"},[t._v("\n                The difference between the market price and estimated price due to trade size\n              ")]),t._v(" "),n("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"question-circle"}})],2)],1),t._v(" "),n("span",{style:"color: "+(t.priceImpact<=5?"#31d0aa":"")},[t._v(" "+t._s(t.priceImpact.toFixed(2))+"% ")])]):t._e()]),t._v(" "),!1===t.officialPool?n("div",[n("div",{staticStyle:{margin:"10px"}},[n("div",[t._v("AMM ID:")]),t._v(" "),n("div",[t._v("\n            "+t._s(t.ammId?t.ammId.substr(0,14):"")+"\n            ...\n            "+t._s(t.ammId?t.ammId.substr(t.ammId.length-14,14):"")+"\n          ")])])]):t._e(),t._v(" "),t.wallet.connected?t.officialPool||!t.officialPool&&t.userCheckUnofficial?n("Button",{class:"swap-btn "+(t.priceImpact>10?"error-style":t.priceImpact>5?"warning-style":""),staticStyle:{width:"100%"},attrs:{size:"large",ghost:"",disabled:!t.fromCoin||!t.fromCoinAmount||!t.toCoin||!t.marketAddress&&!t.lpMintAddress&&!t.isWrap||!t.initialized||t.loading||t.gt(t.fromCoinAmount,t.fromCoin&&t.fromCoin.balance?"SOL"===t.fromCoin.symbol?t.fromCoin.balance.toEther().minus(.05).toFixed(t.fromCoin.balance.decimals):t.fromCoin.balance.fixed():"0")||t.get(t.liquidity.infos,t.lpMintAddress+".status")&&1!==t.get(t.liquidity.infos,t.lpMintAddress+".status")||t.swaping||t.fromCoin.mintAddress===t.TOKENS.xCOPE.mintAddress&&t.gt(5,t.fromCoinAmount)||t.toCoin.mintAddress===t.TOKENS.xCOPE.mintAddress&&t.gt(5,t.toCoinAmount),loading:t.swaping},on:{click:t.placeOrder}},[t.fromCoin&&t.toCoin?(t.marketAddress||t.lpMintAddress||t.isWrap)&&t.initialized?t.fromCoinAmount?t.loading?[t._v(" Updating price information ")]:t.gt(t.fromCoinAmount,t.fromCoin&&t.fromCoin.balance?"SOL"===t.fromCoin.symbol?t.fromCoin.balance.toEther().minus(.05).toFixed(t.fromCoin.balance.decimals):t.fromCoin.balance.fixed():"0")?[t._v("\n          Insufficient "+t._s(t.fromCoin.symbol)+" balance\n        ")]:t.get(t.liquidity.infos,t.lpMintAddress+".status")&&1!==t.get(t.liquidity.infos,t.lpMintAddress+".status")?[t._v("\n          Pool coming soon\n        ")]:t.fromCoin.mintAddress===t.TOKENS.xCOPE.mintAddress&&t.gt(5,t.fromCoinAmount)||t.toCoin.mintAddress===t.TOKENS.xCOPE.mintAddress&&t.gt(5,t.toCoinAmount)?[t._v("\n          xCOPE amount must greater than 5\n        ")]:[t._v(t._s(t.isWrap?"Unwrap":t.priceImpact>5?"Swap Anyway":"Swap"))]:[t._v(" Enter an amount ")]:[t._v("\n          Insufficient liquidity for this trade\n        ")]:[t._v(" Select a token ")]],2):n("Button",{attrs:{size:"large",ghost:""},on:{click:function(){t.setTimeout((function(){t.userCheckUnofficialShow=!0}),1)}}},[t._v("\n        Confirm Risk Warning\n      ")]):n("Button",{attrs:{size:"large",ghost:""},on:{click:t.$accessor.wallet.openModal}},[t._v("\n        Connect Wallet\n      ")]),t._v(" "),t.solBalance&&+t.solBalance.balance.fixed()-.05<=0?n("div",{staticClass:"not-enough-sol-alert"},[n("span",{staticClass:"caution-text"},[t._v("Caution: Your SOL balance is low")]),t._v(" "),n("Tooltip",{attrs:{placement:"bottomLeft"}},[n("template",{slot:"title"},[t._v("\n            SOL is needed for Solana network fees. A minimum balance of 0.05 SOL is recommended to avoid failed\n            transactions.\n          ")]),t._v(" "),n("Icon",{attrs:{type:"question-circle"}})],2)],1):t._e()],1)]),t._v(" "),!t.baseSymbol&&!t.quoteSymbol&&t.isFetchingUnsettled||t.baseUnsettledAmount||t.quoteUnsettledAmount?n("div",{staticClass:"card extra"},[n("div",{staticClass:"settle card-body"},[t.baseSymbol||t.quoteSymbol||!t.isFetchingUnsettled?t.baseSymbol&&t.quoteSymbol&&!t.isFetchingUnsettled&&t.baseUnsettledAmount||t.quoteUnsettledAmount?n("table",{staticClass:"settel-panel"},[t._m(0),t._v(" "),n("tbody",[t.baseSymbol&&t.baseUnsettledAmount?n("tr",{staticClass:"row"},[n("td",[t._v(t._s(t.baseSymbol))]),t._v(" "),n("td",[t._v(t._s(t.baseUnsettledAmount))]),t._v(" "),n("td",{staticClass:"align-right",attrs:{rowspan:"2"}},[n("Button",{staticClass:"btn",attrs:{loading:t.isSettlingBase,ghost:""},on:{click:function(e){return t.settleFunds("base")}}},[t._v("Settle")])],1)]):t._e(),t._v(" "),t.quoteSymbol&&t.quoteUnsettledAmount?n("tr",{staticClass:"row"},[n("td",[t._v(t._s(t.quoteSymbol))]),t._v(" "),n("td",[t._v(t._s(t.quoteUnsettledAmount))]),t._v(" "),t.baseUnsettledAmount?t._e():n("td",{staticClass:"align-right",attrs:{rowspan:"2"}},[n("Button",{staticClass:"btn",attrs:{loading:t.isSettlingBase,ghost:""},on:{click:function(e){return t.settleFunds("base")}}},[t._v("Settle")])],1)]):t._e()])]):t._e():n("div",{staticClass:"fetching-unsettled"},[n("Spin",{attrs:{spinning:!0}},[n("Icon",{staticStyle:{"font-size":"24px"},attrs:{slot:"indicator",type:"loading",spin:""},slot:"indicator"})],1),t._v(" "),n("span",[t._v("Fetching info from market. Please wait.")])],1)])]):t._e()],1)}),[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("thead",[n("tr",[n("th",{attrs:{colspan:"2"}},[t._v("You have unsettled balances:")])])])}],!1,null,null,null);e.default=component.exports;installComponents(component,{CoinSelect:n(416).default,AmmIdSelect:n(409).default,UnofficialPoolConfirmUser:n(418).default,InputAmmIdOrMarket:n(417).default,CoinInput:n(415).default})}}]);